<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pytransform.rotations &#8212; pytransform 0.2 documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootswatch-3.1.0/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          pytransform</a>
        <span class="navbar-text navbar-version pull-left"><b>0.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../rotations.html">3D Rotations: SO(3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../transform_manager.html">Transform Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../camera.html">Camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <h1>Source code for pytransform.rotations</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Rotations in three dimensions - SO(3).&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">.plot_utils</span> <span class="k">import</span> <span class="n">Arrow3D</span><span class="p">,</span> <span class="n">make_3d_axis</span>
<span class="kn">from</span> <span class="nn">numpy.testing</span> <span class="k">import</span> <span class="n">assert_array_almost_equal</span>


<span class="n">unitx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="n">unity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="n">unitz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

<span class="n">R_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">a_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="n">q_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="n">e_xyz_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="n">e_zyx_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="n">p0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

<span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-7</span>


<div class="viewcode-block" id="norm_vector"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.norm_vector.html#pytransform.rotations.norm_vector">[docs]</a><span class="k">def</span> <span class="nf">norm_vector</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Normalize vector.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v : array-like, shape (n,)</span>
<span class="sd">        nd vector</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    u : array-like, shape (n,)</span>
<span class="sd">        nd unit vector with norm 1 or the zero vector</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">v</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm</span></div>


<div class="viewcode-block" id="norm_angle"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.norm_angle.html#pytransform.rotations.norm_angle">[docs]</a><span class="k">def</span> <span class="nf">norm_angle</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Normalize angle to (-pi, pi].</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : float or array-like, shape (n,)</span>
<span class="sd">        Angle(s)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a_norm : float or array-like, shape (n,)</span>
<span class="sd">        Normalized angle(s)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Source of the solution: http://stackoverflow.com/a/32266181</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">%</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span></div>


<div class="viewcode-block" id="norm_axis_angle"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.norm_axis_angle.html#pytransform.rotations.norm_axis_angle">[docs]</a><span class="k">def</span> <span class="nf">norm_axis_angle</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Normalize axis-angle representation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : array-like, shape (4,)</span>
<span class="sd">        Axis of rotation and rotation angle: (x, y, z, angle)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a : array-like, shape (4,)</span>
<span class="sd">        Axis of rotation and rotation angle: (x, y, z, angle). The length</span>
<span class="sd">        of the axis vector is 1 and the angle is in [0, pi). No rotation</span>
<span class="sd">        is represented by [1, 0, 0, 0].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">angle</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">norm</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">res</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">norm</span>

    <span class="k">while</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">+=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">while</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">-=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">if</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="n">res</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="n">res</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle</span>

    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="perpendicular_to_vectors"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.perpendicular_to_vectors.html#pytransform.rotations.perpendicular_to_vectors">[docs]</a><span class="k">def</span> <span class="nf">perpendicular_to_vectors</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute perpendicular vector to two other vectors.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : array-like, shape (3,)</span>
<span class="sd">        3d vector</span>

<span class="sd">    b : array-like, shape (3,)</span>
<span class="sd">        3d vector</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    c : array-like, shape (3,)</span>
<span class="sd">        3d vector that is orthogonal to a and b</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></div>


<div class="viewcode-block" id="angle_between_vectors"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.angle_between_vectors.html#pytransform.rotations.angle_between_vectors">[docs]</a><span class="k">def</span> <span class="nf">angle_between_vectors</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute angle between two vectors.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : array-like, shape (n,)</span>
<span class="sd">        nd vector</span>

<span class="sd">    b : array-like, shape (n,)</span>
<span class="sd">        nd vector</span>

<span class="sd">    fast : bool, optional (default: False)</span>
<span class="sd">        Use fast implementation instead of numerically stable solution</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    angle : float</span>
<span class="sd">        Angle between a and b</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">fast</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span>
                         <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span></div>


<div class="viewcode-block" id="random_vector"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.random_vector.html#pytransform.rotations.random_vector">[docs]</a><span class="k">def</span> <span class="nf">random_vector</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate an nd vector with normally distributed components.</span>

<span class="sd">    Each component will be sampled from :math:`\mathcal{N}(\mu=0, \sigma=1)`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    random_state : np.random.RandomState, optional (default: random seed 0)</span>
<span class="sd">        Random number generator</span>

<span class="sd">    n : int, optional (default: 3)</span>
<span class="sd">        Number of vector components</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    v : array-like, shape (n,)</span>
<span class="sd">        Random vector</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></div>


<div class="viewcode-block" id="random_axis_angle"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.random_axis_angle.html#pytransform.rotations.random_axis_angle">[docs]</a><span class="k">def</span> <span class="nf">random_axis_angle</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">0</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Generate random axis-angle.</span>

<span class="sd">    The angle will be sampled uniformly from the interval :math:`[0, \pi)`</span>
<span class="sd">    and each component of the rotation axis will be sampled from</span>
<span class="sd">    :math:`\mathcal{N}(\mu=0, \sigma=1)` and than the axis will be normalized</span>
<span class="sd">    to length 1.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    random_state : np.random.RandomState, optional (default: random seed 0)</span>
<span class="sd">        Random number generator</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a : array-like, shape (4,)</span>
<span class="sd">        Axis of rotation and rotation angle: (x, y, z, angle)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">random_state</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">])</span>
    <span class="n">a</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm_vector</span><span class="p">(</span><span class="n">random_state</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">a</span></div>


<div class="viewcode-block" id="random_quaternion"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.random_quaternion.html#pytransform.rotations.random_quaternion">[docs]</a><span class="k">def</span> <span class="nf">random_quaternion</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">0</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Generate random quaternion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    random_state : np.random.RandomState, optional (default: random seed 0)</span>
<span class="sd">        Random number generator</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q : array-like, shape (4,)</span>
<span class="sd">        Unit quaternion to represent rotation: (w, x, y, z)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">norm_vector</span><span class="p">(</span><span class="n">random_state</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span></div>


<div class="viewcode-block" id="cross_product_matrix"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.cross_product_matrix.html#pytransform.rotations.cross_product_matrix">[docs]</a><span class="k">def</span> <span class="nf">cross_product_matrix</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate the cross-product matrix of a vector.</span>

<span class="sd">    The cross-product matrix :math:`\\boldsymbol{V}` satisfies the equation</span>

<span class="sd">    .. math::</span>

<span class="sd">        \\boldsymbol{V} \\boldsymbol{w} = \\boldsymbol{v} \\times</span>
<span class="sd">        \\boldsymbol{w}</span>

<span class="sd">    It is a skew-symmetric (antisymmetric) matrix, i.e.</span>
<span class="sd">    :math:`-\\boldsymbol{V} = \\boldsymbol{V}^T`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v : array-like, shape (3,)</span>
<span class="sd">        3d vector</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    V : array-like, shape (3, 3)</span>
<span class="sd">        Cross-product matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                     <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                     <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">]])</span></div>


<div class="viewcode-block" id="check_matrix"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.check_matrix.html#pytransform.rotations.check_matrix">[docs]</a><span class="k">def</span> <span class="nf">check_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Input validation of a rotation matrix.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : array-like, shape (3, 3)</span>
<span class="sd">        Rotation matrix</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    R : array, shape (3, 3)</span>
<span class="sd">        Validated rotation matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected rotation matrix with shape (3, 3), got &quot;</span>
                         <span class="s2">&quot;array-like object with shape </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>
    <span class="n">RRT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">RRT</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected rotation matrix, but it failed the test &quot;</span>
                         <span class="s2">&quot;for inversion by transposition. np.dot(R, R.T) &quot;</span>
                         <span class="s2">&quot;gives </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RRT</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">R</span></div>


<div class="viewcode-block" id="check_axis_angle"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.check_axis_angle.html#pytransform.rotations.check_axis_angle">[docs]</a><span class="k">def</span> <span class="nf">check_axis_angle</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Input validation of axis-angle representation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : array-like, shape (4,)</span>
<span class="sd">        Axis of rotation and rotation angle: (x, y, z, angle)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a : array, shape (4,)</span>
<span class="sd">        Validated axis of rotation and rotation angle: (x, y, z, angle)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected axis and angle in array with shape (4,), &quot;</span>
                         <span class="s2">&quot;got array-like object with shape </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>
    <span class="k">return</span> <span class="n">norm_axis_angle</span><span class="p">(</span><span class="n">a</span><span class="p">)</span></div>


<div class="viewcode-block" id="check_quaternion"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.check_quaternion.html#pytransform.rotations.check_quaternion">[docs]</a><span class="k">def</span> <span class="nf">check_quaternion</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Input validation of quaternion representation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : array-like, shape (4,)</span>
<span class="sd">        Quaternion to represent rotation: (w, x, y, z)</span>

<span class="sd">    unit : bool, optional (default: True)</span>
<span class="sd">        Normalize the quaternion so that it is a unit quaternion</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q : array-like, shape (4,)</span>
<span class="sd">        Validated quaternion to represent rotation: (w, x, y, z)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected quaternion with shape (4,), got &quot;</span>
                         <span class="s2">&quot;array-like object with shape </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">,))</span>
    <span class="k">if</span> <span class="n">unit</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">norm_vector</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">q</span></div>


<div class="viewcode-block" id="matrix_from_axis_angle"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.matrix_from_axis_angle.html#pytransform.rotations.matrix_from_axis_angle">[docs]</a><span class="k">def</span> <span class="nf">matrix_from_axis_angle</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute rotation matrix from axis-angle.</span>

<span class="sd">    This is called exponential map or Rodrigues&#39; formula.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : array-like, shape (4,)</span>
<span class="sd">        Axis of rotation and rotation angle: (x, y, z, angle)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    R : array-like, shape (3, 3)</span>
<span class="sd">        Rotation matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">check_axis_angle</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">uz</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">ci</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">c</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">ci</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">+</span> <span class="n">c</span><span class="p">,</span>
                   <span class="n">ci</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">-</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span>
                   <span class="n">ci</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">s</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">ci</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">+</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span>
                   <span class="n">ci</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="n">c</span><span class="p">,</span>
                   <span class="n">ci</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">-</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">s</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">ci</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">ux</span> <span class="o">-</span> <span class="n">uy</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span>
                   <span class="n">ci</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">uy</span> <span class="o">+</span> <span class="n">ux</span> <span class="o">*</span> <span class="n">s</span><span class="p">,</span>
                   <span class="n">ci</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">*</span> <span class="n">uz</span> <span class="o">+</span> <span class="n">c</span><span class="p">],</span>
                  <span class="p">])</span>

    <span class="c1"># This is equivalent to</span>
    <span class="c1"># R = (np.eye(3) * np.cos(theta) +</span>
    <span class="c1">#      (1.0 - np.cos(theta)) * a[:3, np.newaxis].dot(a[np.newaxis, :3]) +</span>
    <span class="c1">#      cross_product_matrix(a[:3]) * np.sin(theta))</span>

    <span class="k">return</span> <span class="n">R</span></div>


<div class="viewcode-block" id="matrix_from_quaternion"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.matrix_from_quaternion.html#pytransform.rotations.matrix_from_quaternion">[docs]</a><span class="k">def</span> <span class="nf">matrix_from_quaternion</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute rotation matrix from quaternion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : array-like, shape (4,)</span>
<span class="sd">        Unit quaternion to represent rotation: (w, x, y, z)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    R : array-like, shape (3, 3)</span>
<span class="sd">        Rotation matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">check_quaternion</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">uq</span> <span class="o">=</span> <span class="n">norm_vector</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">uq</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span>
    <span class="n">z2</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
    <span class="n">xz</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">z</span>
    <span class="n">yz</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span>
    <span class="n">xw</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">w</span>
    <span class="n">yw</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">w</span>
    <span class="n">zw</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">w</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">z2</span><span class="p">,</span> <span class="n">xy</span> <span class="o">-</span> <span class="n">zw</span><span class="p">,</span> <span class="n">xz</span> <span class="o">+</span> <span class="n">yw</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">xy</span> <span class="o">+</span> <span class="n">zw</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">z2</span><span class="p">,</span> <span class="n">yz</span> <span class="o">-</span> <span class="n">xw</span><span class="p">],</span>
                  <span class="p">[</span><span class="n">xz</span> <span class="o">-</span> <span class="n">yw</span><span class="p">,</span> <span class="n">yz</span> <span class="o">+</span> <span class="n">xw</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">y2</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">R</span></div>


<div class="viewcode-block" id="matrix_from_angle"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.matrix_from_angle.html#pytransform.rotations.matrix_from_angle">[docs]</a><span class="k">def</span> <span class="nf">matrix_from_angle</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute rotation matrix from rotation around basis vector.</span>

<span class="sd">    The combined rotation matrices are either extrinsic and can be used with</span>
<span class="sd">    pre-multiplied column vectors or they are intrinsic and can be used with</span>
<span class="sd">    post-multiplied row vectors. We use a right-hand system with right-hand</span>
<span class="sd">    rotations. We use the alibi convention. That means we use the rotation</span>
<span class="sd">    matrix to rotate a vector directly. In contrast, the alias convention</span>
<span class="sd">    defines a rotation of the reference coordinate system. You can derive</span>
<span class="sd">    the alias rotation matrix by transposing a rotation matrix.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    basis : int from [0, 1, 2]</span>
<span class="sd">        The rotation axis (0: x, 1: y, 2: z)</span>

<span class="sd">    angle : float</span>
<span class="sd">        Rotation angle</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    R : array-like, shape (3, 3)</span>
<span class="sd">        Rotation matrix (can be used to rotate post-multiplied row vectors)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">basis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                      <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">],</span>
                      <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">]])</span>
    <span class="k">elif</span> <span class="n">basis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">s</span><span class="p">],</span>
                      <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                      <span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">c</span><span class="p">]])</span>
    <span class="k">elif</span> <span class="n">basis</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                      <span class="p">[</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                      <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Basis must be in [0, 1, 2]&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">R</span></div>


<div class="viewcode-block" id="matrix_from_euler_xyz"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.matrix_from_euler_xyz.html#pytransform.rotations.matrix_from_euler_xyz">[docs]</a><span class="k">def</span> <span class="nf">matrix_from_euler_xyz</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute rotation matrix from xyz Euler angles.</span>

<span class="sd">    The xyz convention is usually used in physics and chemistry.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    e : array-like, shape (3,)</span>
<span class="sd">        Angles for rotation around x-, y&#39;-, and z&#39;&#39;-axes (intrinsic rotations)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    R : array-like, shape (3, 3)</span>
<span class="sd">        Rotation matrix (can be used to rotate post-multiplied row vectors)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">e</span>
    <span class="c1"># We use intrinsic rotations and generate a rotation matrix that can be</span>
    <span class="c1"># used to post-multiply row vectors</span>
    <span class="n">Qx</span> <span class="o">=</span> <span class="n">matrix_from_angle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="n">Qy</span> <span class="o">=</span> <span class="n">matrix_from_angle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    <span class="n">Qz</span> <span class="o">=</span> <span class="n">matrix_from_angle</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">Qx</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Qy</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Qz</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">R</span></div>


<div class="viewcode-block" id="matrix_from_euler_zyx"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.matrix_from_euler_zyx.html#pytransform.rotations.matrix_from_euler_zyx">[docs]</a><span class="k">def</span> <span class="nf">matrix_from_euler_zyx</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute rotation matrix from zyx Euler angles.</span>

<span class="sd">    The zyx convention is usually used for aircraft dynamics.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    e : array-like, shape (3,)</span>
<span class="sd">        Angles for rotation around z-, y&#39;-, and x&#39;&#39;-axes (intrinsic rotations)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    R : array-like, shape (3, 3)</span>
<span class="sd">        Rotation matrix (can be used to rotate post-multiplied row vectors)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gamma</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">e</span>
    <span class="c1"># We use intrinsic rotations and generate a rotation matrix that can be</span>
    <span class="c1"># used to post-multiply row vectors</span>
    <span class="n">Qz</span> <span class="o">=</span> <span class="n">matrix_from_angle</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
    <span class="n">Qy</span> <span class="o">=</span> <span class="n">matrix_from_angle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    <span class="n">Qx</span> <span class="o">=</span> <span class="n">matrix_from_angle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">Qz</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Qy</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Qx</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">R</span></div>


<div class="viewcode-block" id="matrix_from"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.matrix_from.html#pytransform.rotations.matrix_from">[docs]</a><span class="k">def</span> <span class="nf">matrix_from</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">e_xyz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">e_zyx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute rotation matrix from another representation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : array-like, shape (3, 3)</span>
<span class="sd">        Rotation matrix (can be used to rotate post-multiplied row vectors)</span>

<span class="sd">    a : array-like, shape (4,)</span>
<span class="sd">        Axis of rotation and rotation angle: (x, y, z, angle)</span>

<span class="sd">    q : array-like, shape (4,)</span>
<span class="sd">        Unit quaternion to represent rotation: (w, x, y, z)</span>

<span class="sd">    e_xyz : array-like, shape (3,)</span>
<span class="sd">        Angles for rotation around x-, y&#39;-, and z&#39;&#39;-axes (intrinsic rotations)</span>

<span class="sd">    e_zyx : array-like, shape (3,)</span>
<span class="sd">        Angles for rotation around z-, y&#39;-, and x&#39;&#39;-axes (intrinsic rotations)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    R : array-like, shape (3, 3)</span>
<span class="sd">        Rotation matrix (can be used to rotate post-multiplied row vectors)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO test</span>
    <span class="k">if</span> <span class="n">R</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">R</span>
    <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">matrix_from_axis_angle</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">matrix_from_quaternion</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">e_xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">matrix_from_euler_xyz</span><span class="p">(</span><span class="n">e_xyz</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">e_zyx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">matrix_from_euler_zyx</span><span class="p">(</span><span class="n">e_zyx</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot compute rotation matrix from no rotation.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="euler_xyz_from_matrix"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.euler_xyz_from_matrix.html#pytransform.rotations.euler_xyz_from_matrix">[docs]</a><span class="k">def</span> <span class="nf">euler_xyz_from_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute xyz Euler angles from rotation matrix.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : array-like, shape (3, 3)</span>
<span class="sd">        Rotation matrix (can be used to rotate post-multiplied row vectors)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    e_xyz : array-like, shape (3,)</span>
<span class="sd">        Angles for rotation around x-, y&#39;-, and z&#39;&#39;-axes (intrinsic rotations)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">check_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="c1"># NOTE: There are two solutions: angle2 and pi - angle2!</span>
        <span class="n">angle2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">angle1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle2</span><span class="p">),</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle2</span><span class="p">))</span>
        <span class="n">angle3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle2</span><span class="p">),</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">angle3</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">angle2</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">angle1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">angle3</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">angle2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">angle1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">angle1</span><span class="p">,</span> <span class="n">angle2</span><span class="p">,</span> <span class="n">angle3</span><span class="p">])</span></div>


<div class="viewcode-block" id="euler_zyx_from_matrix"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.euler_zyx_from_matrix.html#pytransform.rotations.euler_zyx_from_matrix">[docs]</a><span class="k">def</span> <span class="nf">euler_zyx_from_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute zyx Euler angles from rotation matrix.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : array-like, shape (3, 3)</span>
<span class="sd">        Rotation matrix (can be used to rotate post-multiplied row vectors)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    e_zyx : array-like, shape (3,)</span>
<span class="sd">        Angles for rotation around z-, y&#39;-, and x&#39;&#39;-axes (intrinsic rotations)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">check_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="c1"># NOTE: There are two solutions: angle2 and pi - angle2!</span>
        <span class="n">angle2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">angle3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle2</span><span class="p">),</span>
                            <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle2</span><span class="p">))</span>
        <span class="n">angle1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle2</span><span class="p">),</span>
                            <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">angle3</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">angle2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">angle1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">angle3</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">angle2</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">angle1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">angle1</span><span class="p">,</span> <span class="n">angle2</span><span class="p">,</span> <span class="n">angle3</span><span class="p">])</span></div>


<div class="viewcode-block" id="axis_angle_from_matrix"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.axis_angle_from_matrix.html#pytransform.rotations.axis_angle_from_matrix">[docs]</a><span class="k">def</span> <span class="nf">axis_angle_from_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute axis-angle from rotation matrix.</span>

<span class="sd">    This operation is called logarithmic map.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : array-like, shape (3, 3)</span>
<span class="sd">        Rotation matrix (can be used to rotate post-multiplied row vectors)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a : array-like, shape (4,)</span>
<span class="sd">        Axis of rotation and rotation angle: (x, y, z, angle). The angle is</span>
<span class="sd">        constrained to [0, pi].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">check_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">angle</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">:</span>
        <span class="n">a</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="c1"># The norm of r is 2.0 * np.sin(angle)</span>
        <span class="n">a</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
    <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle</span>
    <span class="k">return</span> <span class="n">a</span></div>


<div class="viewcode-block" id="axis_angle_from_quaternion"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.axis_angle_from_quaternion.html#pytransform.rotations.axis_angle_from_quaternion">[docs]</a><span class="k">def</span> <span class="nf">axis_angle_from_quaternion</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute axis-angle from quaternion.</span>

<span class="sd">    This operation is called logarithmic map.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : array-like, shape (4,)</span>
<span class="sd">        Unit quaternion to represent rotation: (w, x, y, z)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a : array-like, shape (4,)</span>
<span class="sd">        Axis of rotation and rotation angle: (x, y, z, angle). The angle is</span>
<span class="sd">        constrained to [0, pi) so that the mapping is unique.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">check_quaternion</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">p_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p_norm</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="n">p_norm</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]),)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">axis</span><span class="p">,</span> <span class="n">angle</span><span class="p">))</span></div>


<div class="viewcode-block" id="compact_axis_angle"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.compact_axis_angle.html#pytransform.rotations.compact_axis_angle">[docs]</a><span class="k">def</span> <span class="nf">compact_axis_angle</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute 3-dimensional axis-angle from a 4-dimensional one.</span>

<span class="sd">    In a 3-dimensional axis-angle, the 4th dimension (the rotation) is</span>
<span class="sd">    represented by the norm of the rotation axis vector, which means we</span>
<span class="sd">    transform :math:`\\left( \\boldsymbol{\hat{e}}, \\theta \\right)` to</span>
<span class="sd">    :math:`\\theta \\boldsymbol{\hat{e}}`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : array-like, shape (4,)</span>
<span class="sd">        Axis of rotation and rotation angle: (x, y, z, angle).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a : array-like, shape (3,)</span>
<span class="sd">        Compact representation of axis of rotation and rotation angle. a is</span>
<span class="sd">        the rotation axis and np.linalg.norm(a) is the rotation angle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">angle</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">angle</span></div>


<div class="viewcode-block" id="quaternion_from_matrix"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.quaternion_from_matrix.html#pytransform.rotations.quaternion_from_matrix">[docs]</a><span class="k">def</span> <span class="nf">quaternion_from_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute quaternion from rotation matrix.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        When computing a quaternion from the rotation matrix there is a sign</span>
<span class="sd">        ambiguity: q and -q represent the same rotation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    R : array-like, shape (3, 3)</span>
<span class="sd">        Rotation matrix (can be used to rotate post-multiplied row vectors)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q : array-like, shape (4,)</span>
<span class="sd">        Unit quaternion to represent rotation: (w, x, y, z)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">check_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Source: http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">trace</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">sqrt_trace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">trace</span><span class="p">)</span>
        <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sqrt_trace</span>
        <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">sqrt_trace</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">sqrt_trace</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">sqrt_trace</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
            <span class="n">sqrt_trace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">sqrt_trace</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sqrt_trace</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">sqrt_trace</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">sqrt_trace</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
            <span class="n">sqrt_trace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">sqrt_trace</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">sqrt_trace</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sqrt_trace</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">sqrt_trace</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sqrt_trace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">sqrt_trace</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">sqrt_trace</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">sqrt_trace</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sqrt_trace</span>
    <span class="k">return</span> <span class="n">q</span></div>


<div class="viewcode-block" id="quaternion_from_axis_angle"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.quaternion_from_axis_angle.html#pytransform.rotations.quaternion_from_axis_angle">[docs]</a><span class="k">def</span> <span class="nf">quaternion_from_axis_angle</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute quaternion from axis-angle.</span>

<span class="sd">    This operation is called exponential map.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : array-like, shape (4,)</span>
<span class="sd">        Axis of rotation and rotation angle: (x, y, z, angle)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q : array-like, shape (4,)</span>
<span class="sd">        Unit quaternion to represent rotation: (w, x, y, z)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">check_axis_angle</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">q</span></div>


<div class="viewcode-block" id="concatenate_quaternions"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.concatenate_quaternions.html#pytransform.rotations.concatenate_quaternions">[docs]</a><span class="k">def</span> <span class="nf">concatenate_quaternions</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Concatenate two quaternions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q1 : array-like, shape (4,)</span>
<span class="sd">        First quaternion</span>

<span class="sd">    q2 : array-like, shape (4,)</span>
<span class="sd">        Second quaternion</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q12 : array-like, shape (4,)</span>
<span class="sd">        Quaternion that represents the concatenated rotation q1 * q2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">q1</span> <span class="o">=</span> <span class="n">check_quaternion</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">q2</span> <span class="o">=</span> <span class="n">check_quaternion</span><span class="p">(</span><span class="n">q2</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">q12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">q12</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">q2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">q1</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">q2</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">q12</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">q1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">q2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">q2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">q1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">q1</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">q2</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">return</span> <span class="n">q12</span></div>


<div class="viewcode-block" id="q_prod_vector"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.q_prod_vector.html#pytransform.rotations.q_prod_vector">[docs]</a><span class="k">def</span> <span class="nf">q_prod_vector</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Apply rotation represented by a quaternion to a vector.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : array-like, shape (4,)</span>
<span class="sd">        Unit quaternion to represent rotation: (w, x, y, z)</span>

<span class="sd">    v : array-like, shape (3,)</span>
<span class="sd">        3d vector</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    w : array-like, shape (3,)</span>
<span class="sd">        3d vector</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">check_quaternion</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">t</span><span class="p">)</span></div>


<div class="viewcode-block" id="q_conj"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.q_conj.html#pytransform.rotations.q_conj">[docs]</a><span class="k">def</span> <span class="nf">q_conj</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Conjugate of quaternion.</span>

<span class="sd">    The conjugate represents the inverted rotation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : array-like, shape (4,)</span>
<span class="sd">        Unit quaternion to represent rotation: (w, x, y, z)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q_c : array-like, shape (4,)</span>
<span class="sd">        Conjugate (w, -x, -y, -z)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">check_quaternion</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span></div>


<span class="k">def</span> <span class="nf">_slerp_weights</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">angle</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">angle</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>


<div class="viewcode-block" id="axis_angle_slerp"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.axis_angle_slerp.html#pytransform.rotations.axis_angle_slerp">[docs]</a><span class="k">def</span> <span class="nf">axis_angle_slerp</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Spherical linear interpolation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    start : array-like, shape (4,)</span>
<span class="sd">        Start axis of rotation and rotation angle: (x, y, z, angle)</span>

<span class="sd">    end : array-like, shape (4,)</span>
<span class="sd">        Goal axis of rotation and rotation angle: (x, y, z, angle)</span>

<span class="sd">    t : float in [0, 1]</span>
<span class="sd">        Position between start and goal</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a : array-like, shape (4,)</span>
<span class="sd">        Interpolated axis of rotation and rotation angle: (x, y, z, angle)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">check_axis_angle</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">check_axis_angle</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">angle_between_vectors</span><span class="p">(</span><span class="n">start</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">end</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span> <span class="o">=</span> <span class="n">_slerp_weights</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">w1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">t</span><span class="p">)])</span>
    <span class="n">w2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">w2</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">w2</span><span class="p">,</span> <span class="n">t</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">w1</span> <span class="o">*</span> <span class="n">start</span> <span class="o">+</span> <span class="n">w2</span> <span class="o">*</span> <span class="n">end</span></div>


<div class="viewcode-block" id="quaternion_slerp"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.quaternion_slerp.html#pytransform.rotations.quaternion_slerp">[docs]</a><span class="k">def</span> <span class="nf">quaternion_slerp</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Spherical linear interpolation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    start : array-like, shape (4,)</span>
<span class="sd">        Start unit quaternion to represent rotation: (w, x, y, z)</span>

<span class="sd">    end : array-like, shape (4,)</span>
<span class="sd">        End unit quaternion to represent rotation: (w, x, y, z)</span>

<span class="sd">    t : float in [0, 1]</span>
<span class="sd">        Position between start and goal</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q : array-like, shape (4,)</span>
<span class="sd">        Interpolated unit quaternion to represent rotation: (w, x, y, z)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">check_quaternion</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">check_quaternion</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">angle_between_vectors</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
    <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span> <span class="o">=</span> <span class="n">_slerp_weights</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">w1</span> <span class="o">*</span> <span class="n">start</span> <span class="o">+</span> <span class="n">w2</span> <span class="o">*</span> <span class="n">end</span></div>


<div class="viewcode-block" id="quaternion_dist"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.quaternion_dist.html#pytransform.rotations.quaternion_dist">[docs]</a><span class="k">def</span> <span class="nf">quaternion_dist</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute distance between two quaternions.</span>

<span class="sd">    We use the angular metric of :math:`S^3`, which is defined as</span>

<span class="sd">    .. math::</span>

<span class="sd">        d(q_1, q_2) = \\min(|| \\log(q_1 * \\overline{q_2})||,</span>
<span class="sd">                            2 \\pi - || \\log(q_1 * \\overline{q_2})||)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q1 : array-like, shape (4,)</span>
<span class="sd">        First quaternion</span>

<span class="sd">    q2 : array-like, shape (4,)</span>
<span class="sd">        Second quaternion</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dist : float</span>
<span class="sd">        Distance between q1 and q2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">q1</span> <span class="o">=</span> <span class="n">check_quaternion</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
    <span class="n">q2</span> <span class="o">=</span> <span class="n">check_quaternion</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>
    <span class="n">q12c</span> <span class="o">=</span> <span class="n">concatenate_quaternions</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q_conj</span><span class="p">(</span><span class="n">q2</span><span class="p">))</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">axis_angle_from_quaternion</span><span class="p">(</span><span class="n">q12c</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span></div>


<div class="viewcode-block" id="quaternion_diff"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.quaternion_diff.html#pytransform.rotations.quaternion_diff">[docs]</a><span class="k">def</span> <span class="nf">quaternion_diff</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the rotation in angle-axis format that rotates q2 into q1.</span>

<span class="sd">    .. math::</span>

<span class="sd">        \omega = 2 \log (q_1 * \overline{q_2})</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q1 : array-like, shape (4,)</span>
<span class="sd">        First quaternion</span>

<span class="sd">    q2 : array-line, shape (4,)</span>
<span class="sd">        Second quaternion</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a : array-like, shape (4,)</span>
<span class="sd">        The rotation in angle-axis format that rotates q2 into q1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">q1</span> <span class="o">=</span> <span class="n">check_quaternion</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
    <span class="n">q2</span> <span class="o">=</span> <span class="n">check_quaternion</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>
    <span class="n">q1q2c</span> <span class="o">=</span> <span class="n">concatenate_quaternions</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q_conj</span><span class="p">(</span><span class="n">q2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">axis_angle_from_quaternion</span><span class="p">(</span><span class="n">q1q2c</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_basis"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.plot_basis.html#pytransform.rotations.plot_basis">[docs]</a><span class="k">def</span> <span class="nf">plot_basis</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ax_s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot basis of a rotation matrix.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : Matplotlib 3d axis, optional (default: None)</span>
<span class="sd">        If the axis is None, a new 3d axis will be created</span>

<span class="sd">    R : array-like, shape (3, 3), optional (default: I)</span>
<span class="sd">        Rotation matrix, each column contains a basis vector</span>

<span class="sd">    p : array-like, shape (3,), optional (default: [0, 0, 0])</span>
<span class="sd">        Offset from the origin</span>

<span class="sd">    s : float, optional (default: 1)</span>
<span class="sd">        Scaling of the frame that will be drawn</span>

<span class="sd">    ax_s : float, optional (default: 1)</span>
<span class="sd">        Scaling of the new matplotlib 3d axis</span>

<span class="sd">    kwargs : dict, optional (default: {})</span>
<span class="sd">        Additional arguments for the plotting functions, e.g. alpha</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ax : Matplotlib 3d axis</span>
<span class="sd">        New or old axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">make_3d_axis</span><span class="p">(</span><span class="n">ax_s</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">R</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="s2">&quot;lw&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;lw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="s2">&quot;c&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">]],</span>
                <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">]],</span>
                <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_axis_angle"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.plot_axis_angle.html#pytransform.rotations.plot_axis_angle">[docs]</a><span class="k">def</span> <span class="nf">plot_axis_angle</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a_id</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ax_s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot rotation axis and angle.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : Matplotlib 3d axis, optional (default: None)</span>
<span class="sd">        If the axis is None, a new 3d axis will be created</span>

<span class="sd">    a : array-like, shape (4,), optional (default: [1, 0, 0, 0])</span>
<span class="sd">        Axis of rotation and rotation angle: (x, y, z, angle)</span>

<span class="sd">    p : array-like, shape (3,), optional (default: [0, 0, 0])</span>
<span class="sd">        Offset from the origin</span>

<span class="sd">    s : float, optional (default: 1)</span>
<span class="sd">        Scaling of the axis and angle that will be drawn</span>

<span class="sd">    ax_s : float, optional (default: 1)</span>
<span class="sd">        Scaling of the new matplotlib 3d axis</span>

<span class="sd">    kwargs : dict, optional (default: {})</span>
<span class="sd">        Additional arguments for the plotting functions, e.g. alpha</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ax : Matplotlib 3d axis</span>
<span class="sd">        New or old axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">check_axis_angle</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">make_3d_axis</span><span class="p">(</span><span class="n">ax_s</span><span class="p">)</span>

    <span class="n">axis_arrow</span> <span class="o">=</span> <span class="n">Arrow3D</span><span class="p">(</span>
        <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
        <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
        <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">axis_arrow</span><span class="p">)</span>

    <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">unitx</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span> <span class="k">else</span>
          <span class="n">perpendicular_to_vectors</span><span class="p">(</span><span class="n">unity</span><span class="p">,</span> <span class="n">a</span><span class="p">[:</span><span class="mi">3</span><span class="p">]))</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">perpendicular_to_vectors</span><span class="p">(</span><span class="n">a</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">p1</span><span class="p">)</span>

    <span class="n">angle_p1p2</span> <span class="o">=</span> <span class="n">angle_between_vectors</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
    <span class="n">arc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)):</span>
        <span class="n">w1</span><span class="p">,</span> <span class="n">w2</span> <span class="o">=</span> <span class="n">_slerp_weights</span><span class="p">(</span><span class="n">angle_p1p2</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">arc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">w1</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">w2</span> <span class="o">*</span> <span class="n">p2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">arc</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">arc</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">arc</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">arrow_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">arc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">arc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="p">(</span><span class="n">arc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">arc</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">angle_arrow</span> <span class="o">=</span> <span class="n">Arrow3D</span><span class="p">(</span>
        <span class="n">arrow_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arrow_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">arrow_coords</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">angle_arrow</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">arc_bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">p</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="n">a</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">arc</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">arc_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arc_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">arc_bound</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="assert_axis_angle_equal"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.assert_axis_angle_equal.html#pytransform.rotations.assert_axis_angle_equal">[docs]</a><span class="k">def</span> <span class="nf">assert_axis_angle_equal</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raise an assertion if two axis-angle are not approximately equal.</span>

<span class="sd">    Usually we assume that the rotation axis is normalized to length 1 and</span>
<span class="sd">    the angle is within [0, pi). However, this function ignores these</span>
<span class="sd">    constraints and will normalize the representations before comparison.</span>
<span class="sd">    See numpy.testing.assert_array_almost_equal for a more detailed</span>
<span class="sd">    documentation of the other parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">norm_axis_angle</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">norm_axis_angle</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
    <span class="n">assert_array_almost_equal</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="assert_quaternion_equal"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.assert_quaternion_equal.html#pytransform.rotations.assert_quaternion_equal">[docs]</a><span class="k">def</span> <span class="nf">assert_quaternion_equal</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raise an assertion if two quaternions are not approximately equal.</span>

<span class="sd">    Note that quaternions are equal either if q1 == q2 or if q1 == -q2. See</span>
<span class="sd">    numpy.testing.assert_array_almost_equal for a more detailed documentation</span>
<span class="sd">    of the other parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">assert_array_almost_equal</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="n">assert_array_almost_equal</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="o">-</span><span class="n">q2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="assert_euler_xyz_equal"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.assert_euler_xyz_equal.html#pytransform.rotations.assert_euler_xyz_equal">[docs]</a><span class="k">def</span> <span class="nf">assert_euler_xyz_equal</span><span class="p">(</span><span class="n">e_xyz1</span><span class="p">,</span> <span class="n">e_xyz2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raise an assertion if two xyz Euler angles are not approximately equal.</span>

<span class="sd">    Note that Euler angles are only unique if we limit them to the intervals</span>
<span class="sd">    [-pi, pi], [-pi/2, pi/2], and [-pi, pi] respectively. See</span>
<span class="sd">    numpy.testing.assert_array_almost_equal for a more detailed documentation</span>
<span class="sd">    of the other parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R1</span> <span class="o">=</span> <span class="n">matrix_from_euler_xyz</span><span class="p">(</span><span class="n">e_xyz1</span><span class="p">)</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="n">matrix_from_euler_xyz</span><span class="p">(</span><span class="n">e_xyz2</span><span class="p">)</span>
    <span class="n">assert_array_almost_equal</span><span class="p">(</span><span class="n">R1</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="assert_euler_zyx_equal"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.assert_euler_zyx_equal.html#pytransform.rotations.assert_euler_zyx_equal">[docs]</a><span class="k">def</span> <span class="nf">assert_euler_zyx_equal</span><span class="p">(</span><span class="n">e_zyx1</span><span class="p">,</span> <span class="n">e_zyx2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raise an assertion if two zyx Euler angles are not approximately equal.</span>

<span class="sd">    Note that Euler angles are only unique if we limit them to the intervals</span>
<span class="sd">    [-pi, pi], [-pi/2, pi/2], and [-pi, pi] respectively. See</span>
<span class="sd">    numpy.testing.assert_array_almost_equal for a more detailed documentation</span>
<span class="sd">    of the other parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R1</span> <span class="o">=</span> <span class="n">matrix_from_euler_zyx</span><span class="p">(</span><span class="n">e_zyx1</span><span class="p">)</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="n">matrix_from_euler_zyx</span><span class="p">(</span><span class="n">e_zyx2</span><span class="p">)</span>
    <span class="n">assert_array_almost_equal</span><span class="p">(</span><span class="n">R1</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="assert_rotation_matrix"><a class="viewcode-back" href="../../_apidoc/pytransform.rotations.assert_rotation_matrix.html#pytransform.rotations.assert_rotation_matrix">[docs]</a><span class="k">def</span> <span class="nf">assert_rotation_matrix</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raise an assertion if a matrix is not a rotation matrix.</span>

<span class="sd">    The two properties :math:`\\boldsymbol{I} = \\boldsymbol{R R}^T` and</span>
<span class="sd">    :math:`det(R) = 1` will be checked. See</span>
<span class="sd">    numpy.testing.assert_array_almost_equal for a more detailed documentation</span>
<span class="sd">    of the other parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">assert_array_almost_equal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">assert_array_almost_equal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014, Alexander Fabisch.<br/>
      Last updated on Mar 30, 2017.<br/>
    </p>
  </div>
</footer>
  </body>
</html>